<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是XSS攻击 | 大志前端</title>
    <meta name="description" content="">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.d0761761.css" as="style"><link rel="preload" href="/assets/js/app.860d6138.js" as="script"><link rel="preload" href="/assets/js/2.13cab879.js" as="script"><link rel="preload" href="/assets/js/42.235a464b.js" as="script"><link rel="prefetch" href="/assets/js/10.d09a6ceb.js"><link rel="prefetch" href="/assets/js/11.5a2b7876.js"><link rel="prefetch" href="/assets/js/12.a91b9ab3.js"><link rel="prefetch" href="/assets/js/13.70dbded7.js"><link rel="prefetch" href="/assets/js/14.d5dce36d.js"><link rel="prefetch" href="/assets/js/15.d5445a07.js"><link rel="prefetch" href="/assets/js/16.626ad661.js"><link rel="prefetch" href="/assets/js/17.e8735692.js"><link rel="prefetch" href="/assets/js/18.59fad0e2.js"><link rel="prefetch" href="/assets/js/19.b88e2586.js"><link rel="prefetch" href="/assets/js/20.e71e6075.js"><link rel="prefetch" href="/assets/js/21.ff579162.js"><link rel="prefetch" href="/assets/js/22.5f856542.js"><link rel="prefetch" href="/assets/js/23.c0bed4df.js"><link rel="prefetch" href="/assets/js/24.03b70b12.js"><link rel="prefetch" href="/assets/js/25.0efae57e.js"><link rel="prefetch" href="/assets/js/26.bb875338.js"><link rel="prefetch" href="/assets/js/27.6552247d.js"><link rel="prefetch" href="/assets/js/28.1a243dc5.js"><link rel="prefetch" href="/assets/js/29.b86c4301.js"><link rel="prefetch" href="/assets/js/3.7095872d.js"><link rel="prefetch" href="/assets/js/30.b2164be9.js"><link rel="prefetch" href="/assets/js/31.f947d87d.js"><link rel="prefetch" href="/assets/js/32.24ed0b96.js"><link rel="prefetch" href="/assets/js/33.070d1959.js"><link rel="prefetch" href="/assets/js/34.adca903f.js"><link rel="prefetch" href="/assets/js/35.3288073b.js"><link rel="prefetch" href="/assets/js/36.3d13f7f3.js"><link rel="prefetch" href="/assets/js/37.468ad535.js"><link rel="prefetch" href="/assets/js/38.ed7dc717.js"><link rel="prefetch" href="/assets/js/39.019f8a3a.js"><link rel="prefetch" href="/assets/js/4.a021ebaf.js"><link rel="prefetch" href="/assets/js/40.e099c35e.js"><link rel="prefetch" href="/assets/js/41.9000351d.js"><link rel="prefetch" href="/assets/js/43.b9c3cc87.js"><link rel="prefetch" href="/assets/js/44.523df039.js"><link rel="prefetch" href="/assets/js/45.0bf8011c.js"><link rel="prefetch" href="/assets/js/46.6812e920.js"><link rel="prefetch" href="/assets/js/47.6673d49d.js"><link rel="prefetch" href="/assets/js/48.baacca6b.js"><link rel="prefetch" href="/assets/js/49.1ae46e37.js"><link rel="prefetch" href="/assets/js/5.0097b90f.js"><link rel="prefetch" href="/assets/js/50.4fdafb67.js"><link rel="prefetch" href="/assets/js/51.01a8fa5f.js"><link rel="prefetch" href="/assets/js/52.3577c9b8.js"><link rel="prefetch" href="/assets/js/53.2edf4c53.js"><link rel="prefetch" href="/assets/js/54.86b2562f.js"><link rel="prefetch" href="/assets/js/55.ab095cfb.js"><link rel="prefetch" href="/assets/js/56.20453547.js"><link rel="prefetch" href="/assets/js/57.6fec5738.js"><link rel="prefetch" href="/assets/js/58.5b933352.js"><link rel="prefetch" href="/assets/js/59.011cb942.js"><link rel="prefetch" href="/assets/js/6.0d265af8.js"><link rel="prefetch" href="/assets/js/60.67ef1a0f.js"><link rel="prefetch" href="/assets/js/61.a2a165ff.js"><link rel="prefetch" href="/assets/js/62.2985d094.js"><link rel="prefetch" href="/assets/js/63.ba83348d.js"><link rel="prefetch" href="/assets/js/64.a4627492.js"><link rel="prefetch" href="/assets/js/65.b1a3226f.js"><link rel="prefetch" href="/assets/js/66.3c2a2221.js"><link rel="prefetch" href="/assets/js/7.e1d75158.js"><link rel="prefetch" href="/assets/js/8.0b49752c.js"><link rel="prefetch" href="/assets/js/9.9313a214.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d0761761.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">大志前端</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basics/html/rel.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/basics/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/basics/javascript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/fullstack/" class="nav-link">Web全栈</a></div><div class="nav-item"><a href="/myarticle/" class="nav-link router-link-active">我的文章</a></div><div class="nav-item"><a href="/article/" class="nav-link">优质文章</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/question/" class="nav-link">问题库</a></div><div class="nav-item"><a href="/repository/" class="nav-link">常用库</a></div><div class="nav-item"><a href="/website/" class="nav-link">网站</a></div><div class="nav-item"><a href="/resources/" class="nav-link">资源</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basics/html/rel.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/basics/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/basics/javascript/" class="nav-link">JavaScript</a></li></ul></div></div><div class="nav-item"><a href="/fullstack/" class="nav-link">Web全栈</a></div><div class="nav-item"><a href="/myarticle/" class="nav-link router-link-active">我的文章</a></div><div class="nav-item"><a href="/article/" class="nav-link">优质文章</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/question/" class="nav-link">问题库</a></div><div class="nav-item"><a href="/repository/" class="nav-link">常用库</a></div><div class="nav-item"><a href="/website/" class="nav-link">网站</a></div><div class="nav-item"><a href="/resources/" class="nav-link">资源</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端帮帮忙</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端安全</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myarticle/safe/1.html" class="active sidebar-link">什么是XSS攻击，XSS攻击可以分为哪几类？如何防范XSS攻击？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myarticle/safe/1.html#什么是xss攻击" class="sidebar-link">什么是XSS攻击</a></li><li class="sidebar-sub-header"><a href="/myarticle/safe/1.html#xss分类" class="sidebar-link">XSS分类</a></li><li class="sidebar-sub-header"><a href="/myarticle/safe/1.html#xss攻击的预防" class="sidebar-link">XSS攻击的预防</a></li><li class="sidebar-sub-header"><a href="/myarticle/safe/1.html#最后" class="sidebar-link">最后</a></li><li class="sidebar-sub-header"><a href="/myarticle/safe/1.html#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="什么是xss攻击"><a href="#什么是xss攻击" class="header-anchor">#</a> 什么是XSS攻击</h2> <p><code>Cross-Site-Scripting</code>（跨站脚本攻击），简称<code>XSS</code>，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如Cookie、SessionID等，进而危害数据安全。</p> <p>为了和CSS区分，所以第一个字母改成了X，于是叫做<code>XSS</code>。</p> <p><code>XSS</code>的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信任的，导致恶意脚本被执行。</p> <p>而由于直接在用户的终端运行，恶意代码能够直接获取用户信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。</p> <h2 id="xss分类"><a href="#xss分类" class="header-anchor">#</a> XSS分类</h2> <p>根据攻击的来源，<code>XSS</code>攻击可分为存储型、反射型和DOM型三种。</p> <h3 id="存储型xss"><a href="#存储型xss" class="header-anchor">#</a> 存储型XSS</h3> <p>存储型XSS的攻击步骤：</p> <ol><li>攻击者将恶意代码提交到目标网站的数据库中</li> <li>用户打开目标网站时，网站将恶意代码从数据库取出，拼接在HTML中返回给浏览器</li> <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户行为，调用目标网站接口执行攻击者指定的操作</li></ol> <p><strong>这种攻击常见于带有用户保存数据的网站功能：如论坛发帖、商品评论、用户私信等。</strong></p> <h3 id="反射型xss"><a href="#反射型xss" class="header-anchor">#</a> 反射型XSS</h3> <p>反射型XSS的攻击步骤：</p> <ol><li>攻击者构造出特殊的URL，其中包含恶意代码</li> <li>用户打开带有恶意代码的URL时，网站服务端将恶意代码从URL中取出，拼接在HTML中返回给浏览器</li> <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户行为，调用目标网站接口执行攻击者指定的操作</li></ol> <blockquote><p>反射型XSS跟存储型XSS的区别是：存储型XSS的恶意代码存在数据库里，反射型XSS的恶意代码存在URL里。</p></blockquote> <p><strong>反射型XSS漏洞常见于通过URL传递参数的功能：如网站搜索、跳转等。</strong></p> <p>用于需要用户主动打开恶意的URL才能生效，攻击者往往会结合各种手段诱导用户点击。</p> <p>POST的内容也可以触发反射型XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p> <h3 id="dom型xss"><a href="#dom型xss" class="header-anchor">#</a> DOM型XSS</h3> <p>DOM型XSS的攻击步骤：</p> <ol><li>攻击者构造出特殊的URL，其中包含恶意代码</li> <li>用户打开带有恶意代码的URL</li> <li>用户浏览器接收到响应后解析执行，前端JavaScript取出URL中的恶意代码并执行</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作</li></ol> <blockquote><p>DOM型XSS跟前面两种XSS的区别：DOM型XSS攻击中，取出和执行恶意代码由浏览器端完成，属于前端JavaScript自身的安全漏洞，而其他两种XSS都属于服务端的安全漏洞</p></blockquote> <h2 id="xss攻击的预防"><a href="#xss攻击的预防" class="header-anchor">#</a> XSS攻击的预防</h2> <p>通过前面的介绍可以得知，<code>XSS</code>攻击有两大要素：</p> <ol><li>攻击者提交恶意代码</li> <li>浏览器执行恶意代码</li></ol> <p>针对第一个要素：我们是否能够在用户输入的过程，过滤掉用户输入的恶意代码呢？</p> <h3 id="_1-输入过滤"><a href="#_1-输入过滤" class="header-anchor">#</a> 1.输入过滤</h3> <h4 id="在用户提交时，由前端过滤输入，然后提交到后端。这样做是否可行？"><a href="#在用户提交时，由前端过滤输入，然后提交到后端。这样做是否可行？" class="header-anchor">#</a> 在用户提交时，由前端过滤输入，然后提交到后端。这样做是否可行？</h4> <p>答案是不可行。一旦攻击者绕过前端过滤，直接构造请求，就可以提交恶意代码了。</p> <h4 id="那么换一个过滤时机：后端在写入数据库前，对输入进行过滤，然后把“安全”的内容，返回给前端。这样是否可行呢？"><a href="#那么换一个过滤时机：后端在写入数据库前，对输入进行过滤，然后把“安全”的内容，返回给前端。这样是否可行呢？" class="header-anchor">#</a> 那么换一个过滤时机：后端在写入数据库前，对输入进行过滤，然后把“安全”的内容，返回给前端。这样是否可行呢？</h4> <p>我们举一个例子，一个正常的用户输入了<code>5 &gt; 7</code>这个内容，在写入数据库前被转义，变成了<code>5 &amp;lt; 7</code>。</p> <p>问题是：在提交阶段，我们并不确定内容要输出到哪里。</p> <p>这里的“并不确定内容要输出到哪里”有两层含义：</p> <ol><li>用户输入的内容可能同时提供给前端和客户端，而一旦经过<code>escapeHTML()</code>，客户端显示的内容就变成了乱码(<code>5 &amp;lt; 7</code>)。</li> <li>在前端中，不同的位置所需的编码也不同。</li></ol> <ul><li>当<code>5 &amp;lt; 7</code>作为HTML拼接页面时，可以正常显示：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;div class=&quot;comment&quot;&gt;5 lt; 7&lt;/div&gt;
</code></pre></div><ul><li>当<code>5 lt; 7</code>通过Ajax返回，然后复制给JavaScript变量时，前端得到的字符串就是转移后的字符。这个字符不能用于Vue等模板的展示，也不能直接用于内容长度的计算。不能用于标题、alert等。</li></ul> <blockquote><p>疑问：展示的时候再进行一次转义是否可以？</p></blockquote> <p>所以，输入侧过滤能够在某些情况下解决特定的XSS问题，但会引入很大的不确定性和乱码问题。在防范XSS攻击时应避免此类方法。</p> <p>当然，对于明确的输入类型，例如数字、URL、电话号码、邮件地址等内容，进行输入过滤还是必要的。</p> <p>既然输入过滤并非完全可靠，我们就要通过“防止浏览器执行恶意代码”来防范XSS。这部分分为两类：</p> <ul><li>防止HTML中出现注入</li> <li>防止JavaScript执行时，执行恶意代码</li></ul> <h3 id="_2-预防存储型和反射型xss攻击"><a href="#_2-预防存储型和反射型xss攻击" class="header-anchor">#</a> 2.预防存储型和反射型XSS攻击</h3> <p>存储型和反射型XSS都是在服务端取出恶意代码后，插入到相应HTML里的，攻击者刻意编写的“数据”被内嵌到“代码”中，被浏览器执行。</p> <p>预防这两种漏洞，有两种常见做法：</p> <ul><li>改成纯前端渲染，把代码和数据分隔开</li> <li>对HTML做充分转义</li></ul> <h4 id="纯前端渲染"><a href="#纯前端渲染" class="header-anchor">#</a> 纯前端渲染</h4> <p>纯前端渲染的过程：</p> <ol><li>浏览器先加载一个静态的HTML，此HTMl中不包含任何跟业务相关的数据</li> <li>然后浏览器执行HTML中的JavaScript</li> <li>JavaScript通过Ajax加载业务数据，调用DOM API更新到页面上</li></ol> <h4 id="转义html"><a href="#转义html" class="header-anchor">#</a> 转义HTML</h4> <p>如果拼接HTML是必要的，就需要采用合适的转义库，对HTML模板各处插入点进行充分的转义。</p> <p>常用的模板引擎，如doT.js、ejs、FreeMarker等，对于HTML转义通常只有一个规则，就是把<code>&amp; &lt; &gt; &quot; ' /</code>这几个字符转义掉，确实能起到一定的<code>XSS</code>防护作用，但是并不完善。</p> <table><thead><tr><th>XSS安全漏斗</th> <th>简单转义是否有防护作用</th></tr></thead> <tbody><tr><td>HTML 标签文字内容</td> <td>有</td></tr> <tr><td>HTML属性值</td> <td>有</td></tr> <tr><td>CSS内联样式</td> <td>无</td></tr> <tr><td>内联JavaScript</td> <td>无</td></tr> <tr><td>内联JSON</td> <td>无</td></tr> <tr><td>跳转链接</td> <td>无</td></tr></tbody></table> <p>所以要完善<code>XSS</code>防护措施，我们要使用更完善更细致的转义策略。</p> <h3 id="_3-预防dom型xss攻击"><a href="#_3-预防dom型xss攻击" class="header-anchor">#</a> 3.预防DOM型XSS攻击</h3> <p>DOM型XSS攻击，实际上就是网站前端JavaScript代码本身不够严谨，把不可信的数据当做代码执行了。</p> <p>在使用<code>.innerHTML</code>、<code>outerHTML</code>、<code>document.write()</code>时要特别小心，不要把不可信的数据作为HTMl插入到页面上，而应尽量使用<code>.textContent</code>、<code>setAttribute()</code>等。</p> <p>如果使用Vue/React技术栈，并且不使用<code>v-html</code>/<code>dangerousSetInnerHTML</code>功能，就在前端render阶段避免<code>innerHTML</code>、<code>outerHTML</code>的XSS隐患。</p> <p>DOM中的内联事件监听器，如<code>location</code>、<code>onclick</code>、<code>onerror</code>、<code>onload</code>、<code>onmouseover</code>等，<code>&lt;a&gt;</code>标签的<code>href</code>属性，JavaScript的<code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code>等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些API，很容易产生安全隐患，请务必避免。</p> <h3 id="_4-其他xss防范措施"><a href="#_4-其他xss防范措施" class="header-anchor">#</a> 4.其他XSS防范措施</h3> <p>虽然在渲染页面和执行JavaScript时，通过谨慎的转义可以防止<code>XSS</code>的发生，但完全依靠开发的谨慎依然是不够的。以下介绍一些通用的方案，可以降低<code>XSS</code>带来的风险和后果。</p> <h4 id="_4-1-content-security-policy"><a href="#_4-1-content-security-policy" class="header-anchor">#</a> 4.1 Content Security Policy</h4> <h4 id="_4-2-输入内容长度限制"><a href="#_4-2-输入内容长度限制" class="header-anchor">#</a> 4.2 输入内容长度限制</h4> <h4 id="其他安全措施"><a href="#其他安全措施" class="header-anchor">#</a> 其他安全措施</h4> <ul><li>HTTP-only Cookie：禁止JavaScript读取某些敏感Cookie，攻击者完成<code>XSS</code>注入后也无法窃取此Cookie</li> <li>验证码：防止脚本冒充用户提交危险操作</li></ul> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>感谢您的阅读，希望对你有所帮助。由于本人水平有限，如果文中有不当的地方烦请指正，感激不尽。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://juejin.im/post/5bad9140e51d450e935c6d64#comment" target="_blank">前端安全系列（一）：如何防止XSS攻击？</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1/21/2020, 4:46:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myarticle/html5/2.html" class="prev">关于a标签，你可能不知道的rel用法</a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.860d6138.js" defer></script><script src="/assets/js/2.13cab879.js" defer></script><script src="/assets/js/42.235a464b.js" defer></script>
  </body>
</html>
